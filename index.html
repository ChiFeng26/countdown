<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SJTU Countdown Timer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #0d1117;
        color: #e6edf3;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    h1 { font-size: 6vw; }
    #timer { font-size: 15vw; margin: 20px 0; }
    button {
        width: 200px;
        height: 70px;
        font-size: 1.5em;
        margin: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        text-align: center;
        line-height: 70px;
        transition: 0.3s;
    }
    button:disabled { background: #444; color: #888; cursor: not-allowed; }
    #startBtn { background: #28a745; color: white; }
    #pauseBtn { background: #d9534f; color: white; }
    #resumeBtn { background: #007bff; color: white; }
    #resetBtn { background: #ffc107; color: black; }
</style>
</head>
<body>

<!-- <h1 id="title">自主传球计时器</h1> -->
<h1 id="title">自主投篮计时器</h1>
<div id="timer">00:00</div>
<div>
    <button id="startBtn">Start</button>
    <button id="pauseBtn" disabled>Pause</button>
    <button id="resumeBtn" style="display:none;">Resume</button>
    <button id="resetBtn" style="display:none;">Reset</button>
</div>

<script>
const sequences = [
    { title: "进场准备时间", duration: 90 },
    // { title: "第一回合", duration: 90 },
    { title: "第一回合", duration: 120 },
    { title: "准备时间", duration: 60 },
    { title: "第二回合", duration: 120 },
    { title: "准备时间", duration: 60 },
    { title: "第三回合", duration: 120 },
    { title: "退场时间", duration: 60 }
];

let current = 0;
let remaining = sequences[current].duration;
let interval = null;
let isPaused = false;
// const defaultTitle = "自主传球计时器";
const defaultTitle = "自主投篮计时器";

const titleEl = document.getElementById("title");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resumeBtn = document.getElementById("resumeBtn");
const resetBtn = document.getElementById("resetBtn");

function updateTimerDisplay() {
    const mins = Math.floor(remaining / 60);
    const secs = remaining % 60;
    timerEl.textContent = `${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
}

function updateButtons(state) {
    if(state === "ready") {
        startBtn.disabled = false; pauseBtn.disabled = true;
        startBtn.style.display="inline-block"; pauseBtn.style.display="inline-block";
        resumeBtn.style.display="none"; resetBtn.style.display="none";
    } else if(state==="running") {
        startBtn.disabled=true; pauseBtn.disabled=false;
        startBtn.style.display="inline-block"; pauseBtn.style.display="inline-block";
        resumeBtn.style.display="none"; resetBtn.style.display="none";
    } else if(state==="paused") {
        startBtn.style.display="none"; pauseBtn.style.display="none";
        resumeBtn.style.display="inline-block"; resetBtn.style.display="inline-block";
    } else if(state==="finished") {
        startBtn.style.display="none"; pauseBtn.style.display="none";
        resumeBtn.style.display="inline-block"; resetBtn.style.display="inline-block";
        resumeBtn.disabled = true; resetBtn.disabled = false;
    }
}

function saveState(runningState="running") {
    localStorage.setItem("countdownState", JSON.stringify({
        current,
        remaining,
        isPaused,
        state: runningState
    }));
}

function loadState() {
    const data = localStorage.getItem("countdownState");
    if(!data) return;
    const {current:c, remaining:r, isPaused:p, state} = JSON.parse(data);

    current = c;
    remaining = r;
    isPaused = p;

    if(state === "ready") {
        clearInterval(interval);
        titleEl.textContent = defaultTitle;
        remaining = sequences[0].duration;
        updateTimerDisplay();
        updateButtons("ready");
        return;
    } else if(state === "finished") {
        clearInterval(interval);
        titleEl.textContent = "比赛结束!";
        remaining = 0;
        updateTimerDisplay();
        updateButtons("finished");
        return;
    }

    titleEl.textContent = sequences[current] ? sequences[current].title : "比赛结束!";
    updateTimerDisplay();

    if(state==="paused") updateButtons("paused");
    else if(state==="running") updateButtons("running"); // 不启动 interval
}

function startTimer(){
    titleEl.textContent = sequences[current].title;
    updateButtons("running");
    clearInterval(interval);
    interval = setInterval(()=>{
        if(!isPaused){
            remaining--;
            updateTimerDisplay();
            saveState("running");

            if(remaining<=0){
                clearInterval(interval);
                current++;
                if(current<sequences.length){
                    remaining=sequences[current].duration;
                    startTimer(); // 主页面继续下一个阶段
                } else {
                    // 倒计时结束
                    clearInterval(interval);
                    titleEl.textContent="比赛结束!";
                    remaining=0;
                    updateTimerDisplay();
                    updateButtons("finished");
                    // 同步给其他标签页
                    localStorage.setItem("countdownState", JSON.stringify({
                        current, remaining, isPaused:true, state:"finished"
                    }));
                }
            }
        }
    },1000);
}

// 按钮事件
startBtn.addEventListener("click", ()=>{
    isPaused=false;
    saveState("running");
    startTimer();
});

pauseBtn.addEventListener("click", ()=>{
    isPaused=true;
    clearInterval(interval);
    updateButtons("paused");
    saveState("paused");
});

resumeBtn.addEventListener("click", ()=>{
    isPaused=false;
    saveState("running");
    updateButtons("running");
    startTimer();
});

resetBtn.addEventListener("click", ()=>{
    clearInterval(interval);
    current=0; remaining=sequences[0].duration; isPaused=false;
    titleEl.textContent=defaultTitle;
    updateTimerDisplay();
    updateButtons("ready");

    // 同步 Ready 状态
    localStorage.setItem("countdownState", JSON.stringify({
        current, remaining, isPaused, state:"ready"
    }));
});

// 同步其他标签页
window.addEventListener("storage",(event)=>{
    if(event.key==="countdownState") loadState();
});

// 初始化显示
updateTimerDisplay();
updateButtons("ready");
loadState();

</script>
</body>
</html>
